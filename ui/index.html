<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesh Network UI</title>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const messageForm = document.getElementById('message-form');
            const messageInput = document.getElementById('message-input');
            const messagesContainer = document.getElementById('messages');
            const locationsContainer = document.getElementById('locations');

            function addMessage(message) {
                const messageElement = document.createElement('div');
                messageElement.textContent = message;
                messagesContainer.appendChild(messageElement);
            }

            function addLocation(location) {
                const locationElement = document.createElement('div');
                locationElement.textContent = location;
                locationsContainer.appendChild(locationElement);
            }

            function fetchMessages() {
                fetch('http://localhost:5000/get_messages')
                    .then(response => response.json())
                    .then(data => {
                        messagesContainer.innerHTML = '';
                        data.forEach(addMessage);
                    });
            }

            function fetchLocations() {
                fetch('http://localhost:5000/get_locations')
                    .then(response => response.json())
                    .then(data => {
                        locationsContainer.innerHTML = '';
                        data.forEach(addLocation);
                    });
            }

            messageForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const message = messageInput.value;
                fetch('http://localhost:5000/send_message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'message sent') {
                            addMessage(message);
                            messageInput.value = '';
                        } else {
                            console.error('Error sending message:', data.message);
                        }
                    })
                    .catch(error => console.error('Error sending message:', error));
            });

            // Connect to the mesh network when the page loads
            fetch('http://localhost:5000/connect', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'connected') {
                        console.log('Connected to the mesh network');
                        fetchMessages();
                        fetchLocations();
                    } else {
                        console.error('Error connecting to the mesh network:', data.message);
                    }
                })
                .catch(error => console.error('Error connecting to the mesh network:', error));
        });
    </script>
</head>
<body>
    <h1>Mesh Network UI</h1>
    <form id="message-form">
        <input type="text" id="message-input" placeholder="Enter your message" required>
        <button type="submit">Send</button>
    </form>
    <div>
        <h2>Messages</h2>
        <div id="messages"></div>
    </div>
    <div>
        <h2>Locations</h2>
        <div id="locations"></div>
    </div>
</body>
</html>
